<!DOCTYPE html><html><head><title>SECrackRockViewController.m</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="doc-style.css"><script src="doc-filelist.js"></script><script>var relativeDir = '', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"><div class="heading h2"><a href="#secrackrockviewcontroller">SECrackRockViewController</a></div><div class="heading h4"><a href="#initwithnibname-bundle-">initWithNibName:bundle:</a></div><div class="heading h4"><a href="#viewdidload">viewDidLoad</a></div><div class="heading h4"><a href="#viewdidunload">viewDidUnload</a></div><div class="heading h4"><a href="#viewwillappear-">viewWillAppear:</a></div><div class="heading h4"><a href="#viewwilldisappear-">viewWillDisappear:</a></div><div class="heading h4"><a href="#didreceivememorywarning">didReceiveMemoryWarning</a></div><div class="heading h4"><a href="#shouldautorotatetointerfaceorientation-">shouldAutorotateToInterfaceOrientation:</a></div><div class="heading h4"><a href="#registerforallnotifications">registerForAllNotifications</a></div><div class="heading h4"><a href="#unregisterforallnotifications">unregisterForAllNotifications</a></div><div class="heading h4"><a href="#shoulddisplayproductinstore-">shouldDisplayProductInStore:</a></div><div class="heading h4"><a href="#purchaseableindicatorforproduct-">purchaseableIndicatorForProduct:</a></div><div class="heading h4"><a href="#iconforproduct-withpurchaseableindicator-">iconForProduct:withPurchaseableIndicator:</a></div><div class="heading h4"><a href="#initializemenuitems">initializeMenuItems</a></div><div class="heading h4"><a href="#menuitemforproductid-">menuItemForProductID:</a></div><div class="heading h4"><a href="#iconwastappedforproduct-">iconWasTappedForProduct:</a></div><div class="heading h4"><a href="#trytopurchaseproduct-">tryToPurchaseProduct:</a></div><div class="heading h4"><a href="#trytorestorepurchase-">tryToRestorePurchase:</a></div><div class="heading h4"><a href="#trytorestoreallpurchases">tryToRestoreAllPurchases</a></div><div class="heading h4"><a href="#didfinishpreparingproductinfo">didFinishPreparingProductInfo</a></div><div class="heading h4"><a href="#restorepurchasesbuttonclicked">restorePurchasesButtonClicked</a></div><div class="heading h4"><a href="#recreateproducticonwithoutpurchaseableindicator-">recreateProductIconWithoutPurchaseableIndicator:</a></div><div class="heading h4"><a href="#displayalerttouserwithtitle-text-dismisstext-">displayAlertToUserWithTitle:text:dismissText:</a></div><div class="heading h4"><a href="#successfulpurchase-">successfulPurchase:</a></div><div class="heading h4"><a href="#cancelledpurchase-">cancelledPurchase:</a></div><div class="heading h4"><a href="#failedpurchase-">failedPurchase:</a></div><div class="heading h4"><a href="#successfulrestore-">successfulRestore:</a></div><div class="heading h4"><a href="#multiplerestorecomplete-">multipleRestoreComplete:</a></div><div class="heading h4"><a href="#incompleterestore-">incompleteRestore:</a></div><div class="heading h4"><a href="#failedrestore-">failedRestore:</a></div></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"><h1>SECrackRockViewController.m</h1></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
</td><td class="code highlight"><div class="highlight"><pre><span class="cp">//</span>
<span class="cp">//  SECrackRockViewController.m</span>
<span class="cp">//  iOS-CrackRock in-app purchase framework</span>
<span class="cp">//</span>
<span class="cp">//  Created by bryn austin bellomy on 6/19/12.</span>
<span class="cp">//  Copyright (c) 2012 robot bubble bath LLC. All rights reserved.</span>
<span class="cp">//</span>

<span class="cp">#import &lt;iOS-BlingLord/SEBlingLordView.h&gt;</span>
<span class="cp">#import &lt;iOS-BlingLord/SEBlingLordMenuItem.h&gt;</span>
<span class="cp">#import &lt;ObjC-StatelyNotificationRobot/SEStatelyNotificationRobot.h&gt;</span>

<span class="cp">#import &quot;SECrackRockViewController.h&quot;</span>
<span class="cp">#import &quot;SECrackRock.h&quot;</span>
<span class="cp">#import &quot;SECrackRockProduct.h&quot;</span>
<span class="cp">#import &quot;UIImage+SECrackRock.h&quot;</span>


<span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">SECrackRockTransactionStateObserver_SpringboardView</span> <span class="o">=</span> <span class="s">@&quot;SECrackRockTransactionStateObserver_SpringboardView&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">SECrackRockTransactionStateObserver_RestorePurchasesButton</span> <span class="o">=</span> <span class="s">@&quot;SECrackRockTransactionStateObserver_RestorePurchasesButton&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">SECrackRockProductsRequestStateObserver_SECrackRockViewController</span> <span class="o">=</span> <span class="s">@&quot;SECrackRockProductsRequestStateObserver_SECrackRockViewController&quot;</span><span class="p">;</span>


<span class="k">@implementation</span> <span class="nc">SECrackRockMenuItem</span>
  <span class="k">@synthesize</span> <span class="n">productID</span> <span class="o">=</span> <span class="n">_productID</span><span class="p">;</span>
<span class="k">@end</span>



<span class="k">@interface</span> <span class="nc">SECrackRockViewController</span> <span class="p">()</span>
  <span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">weak</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">)</span> <span class="n">UIBarButtonItem</span> <span class="o">*</span><span class="n">restorePurchasesButton</span><span class="p">;</span>
<span class="k">@end</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="secrackrockviewcontroller">
  <h2>
    <a href="#secrackrockviewcontroller" class="pilcrow">&#182;</a>
    SECrackRockViewController
  </h2>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">SECrackRockViewController</span>


<span class="cp">#pragma mark- View lifecycle</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="initwithnibname-bundle-">
  <h4>
    <a href="#initwithnibname-bundle-" class="pilcrow">&#182;</a>
    initWithNibName:bundle:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">nibNameOrNil</code></div><div class="dox_tag_detail"><span class="dox_type">NSBundle*</span><code class="name">nibBundleOrNil</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">id</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibNameOrNil</span> <span class="nf">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundleOrNil</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">self</span><span class="p">.</span><span class="n">springboardItemSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mf">83.0f</span><span class="p">,</span> <span class="mf">103.0f</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="viewdidload">
  <h4>
    <a href="#viewdidload" class="pilcrow">&#182;</a>
    viewDidLoad
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">viewDidLoad</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="viewdidunload">
  <h4>
    <a href="#viewdidunload" class="pilcrow">&#182;</a>
    viewDidUnload
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">viewDidUnload</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidUnload</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="viewwillappear-">
  <h4>
    <a href="#viewwillappear-" class="pilcrow">&#182;</a>
    viewWillAppear:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">BOOL</span><code class="name">animated</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">viewWillAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">super</span> <span class="nl">viewWillAppear:</span> <span class="n">animated</span><span class="p">];</span>
  
  <span class="c1">// provide a default title on the view&#39;s navigation bar</span>
  <span class="n">self</span><span class="p">.</span><span class="n">navigationItem</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">@&quot;Store&quot;</span><span class="p">;</span>
  
  <span class="c1">// add the &#39;restore purchases&#39; button to the navigation bar</span>
  <span class="n">UIBarButtonItem</span> <span class="o">*</span><span class="n">button</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIBarButtonItem</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span> <span class="s">@&quot;Restore Purchases&quot;</span>
                                                             <span class="nl">style:</span> <span class="n">UIBarButtonItemStylePlain</span> <span class="nl">target:</span> <span class="n">self</span>
                                                            <span class="nl">action:</span> <span class="k">@selector</span><span class="p">(</span><span class="n">restorePurchasesButtonClicked</span><span class="p">)];</span>
  <span class="n">button</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
  <span class="n">self</span><span class="p">.</span><span class="n">navigationItem</span><span class="p">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="n">button</span><span class="p">;</span>
  <span class="n">self</span><span class="p">.</span><span class="n">restorePurchasesButton</span> <span class="o">=</span> <span class="n">button</span><span class="p">;</span>
  
  <span class="c1">// remove any existing observer</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockTransactionStateObserver_RestorePurchasesButton</span><span class="p">];</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockProductsRequestStateObserver_SECrackRockViewController</span><span class="p">];</span>
  
  <span class="n">__bryn_weak</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">handleStateOf:</span> <span class="n">SECrackRockState_TransactionState</span>
                                                <span class="nl">handlerID:</span> <span class="n">SECrackRockTransactionStateObserver_RestorePurchasesButton</span>
                                                  <span class="nl">onQueue:</span> <span class="p">[</span><span class="n">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span>
                                                <span class="nl">withBlock:</span> <span class="o">^</span><span class="p">(</span><span class="n">SEState</span> <span class="n">newState</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">stateInfo</span><span class="p">)</span> <span class="p">{</span>
                                                  
                                                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;handler for TransactionState state change: newState == %d&quot;</span><span class="p">,</span> <span class="n">newState</span><span class="p">);</span>
                                                    <span class="n">__strong</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">strongSelf</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">;</span>
                                                    
                                                    <span class="kt">BOOL</span> <span class="n">enabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">newState</span> <span class="o">==</span> <span class="n">SECrackRockTransactionStateAsleep</span><span class="p">);</span>
                                                    <span class="n">strongSelf</span><span class="p">.</span><span class="n">restorePurchasesButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">;</span>
                                                  
                                                <span class="p">}];</span>
  
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">handleStateOf:</span> <span class="n">SECrackRockState_ProductsRequestState</span>
                                                <span class="nl">handlerID:</span> <span class="n">SECrackRockProductsRequestStateObserver_SECrackRockViewController</span>
                                                  <span class="nl">onQueue:</span> <span class="p">[</span><span class="n">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span>
                                                <span class="nl">withBlock:</span> <span class="o">^</span><span class="p">(</span><span class="n">SEState</span> <span class="n">newState</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">stateInfo</span><span class="p">)</span> <span class="p">{</span>
                                                  
                                                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;handler for ProductsRequestState state change: newState == %d&quot;</span><span class="p">,</span> <span class="n">newState</span><span class="p">);</span>
                                                    <span class="n">__strong</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">strongSelf</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">;</span>
                                                    <span class="k">if</span> <span class="p">(</span><span class="n">newState</span> <span class="o">==</span> <span class="n">SECrackRockProductsRequestStateFinished</span><span class="p">)</span> <span class="p">{</span>
                                                      <span class="p">[</span><span class="n">strongSelf</span> <span class="n">didFinishPreparingProductInfo</span><span class="p">];</span>
                                                    <span class="p">}</span>
                                                  
                                                <span class="p">}];</span>

  <span class="c1">// register for the notifications posted by SECrackRock</span>
  <span class="p">[</span><span class="n">self</span> <span class="n">registerForAllNotifications</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="viewwilldisappear-">
  <h4>
    <a href="#viewwilldisappear-" class="pilcrow">&#182;</a>
    viewWillDisappear:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">BOOL</span><code class="name">animated</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">viewWillDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">super</span> <span class="nl">viewWillDisappear:</span><span class="n">animated</span><span class="p">];</span>
    
  <span class="c1">// remove all notification handlers and SEStatelyNotificationRobot state handlers</span>
  <span class="p">[</span><span class="n">self</span> <span class="n">unregisterForAllNotifications</span><span class="p">];</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockTransactionStateObserver_SpringboardView</span><span class="p">];</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockTransactionStateObserver_RestorePurchasesButton</span><span class="p">];</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockProductsRequestStateObserver_SECrackRockViewController</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="didreceivememorywarning">
  <h4>
    <a href="#didreceivememorywarning" class="pilcrow">&#182;</a>
    didReceiveMemoryWarning
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">didReceiveMemoryWarning</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="n">didReceiveMemoryWarning</span><span class="p">];</span>
    <span class="c1">// Dispose of any resources that can be recreated.</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="shouldautorotatetointerfaceorientation-">
  <h4>
    <a href="#shouldautorotatetointerfaceorientation-" class="pilcrow">&#182;</a>
    shouldAutorotateToInterfaceOrientation:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">UIInterfaceOrientation</span><code class="name">interfaceOrientation</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">BOOL</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span> <span class="nf">shouldAutorotateToInterfaceOrientation:</span><span class="p">(</span><span class="n">UIInterfaceOrientation</span><span class="p">)</span><span class="nv">interfaceOrientation</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">interfaceOrientation</span> <span class="o">==</span> <span class="n">UIInterfaceOrientationPortrait</span><span class="p">);</span>
<span class="p">}</span>



<span class="cp">#pragma mark- Notification handling</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="registerforallnotifications">
  <h4>
    <a href="#registerforallnotifications" class="pilcrow">&#182;</a>
    registerForAllNotifications
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">registerForAllNotifications</span> <span class="p">{</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">successfulPurchase:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_SuccessfulPurchase</span>      <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">cancelledPurchase:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_CancelledPurchase</span>       <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">failedPurchase:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_FailedPurchase</span>          <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">successfulRestore:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_SuccessfulRestore</span>       <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">multipleRestoreComplete:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_MultipleRestoreComplete</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">incompleteRestore:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_IncompleteRestore</span>       <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserver:</span> <span class="n">self</span> <span class="nl">selector:</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">failedRestore:</span><span class="p">)</span>
                                               <span class="nl">name:</span> <span class="n">SECrackRockNotification_FailedRestore</span>           <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="unregisterforallnotifications">
  <h4>
    <a href="#unregisterforallnotifications" class="pilcrow">&#182;</a>
    unregisterForAllNotifications
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">unregisterForAllNotifications</span> <span class="p">{</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_SuccessfulPurchase</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_CancelledPurchase</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_FailedPurchase</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_SuccessfulRestore</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_MultipleRestoreComplete</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_IncompleteRestore</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
  <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">removeObserver:</span><span class="n">self</span> <span class="nl">name:</span><span class="n">SECrackRockNotification_FailedRestore</span> <span class="nl">object:</span><span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]];</span>
<span class="p">}</span>



<span class="cp">#pragma mark- BlingLord springboard view (+ misc. graphics)</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="shoulddisplayproductinstore-">
  <h4>
    <a href="#shoulddisplayproductinstore-" class="pilcrow">&#182;</a>
    shouldDisplayProductInStore:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">SECrackRockProduct*</span><code class="name">product</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">BOOL</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span> <span class="nf">shouldDisplayProductInStore:</span><span class="p">(</span><span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="p">)</span><span class="nv">product</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">product</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;product argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="kt">BOOL</span> <span class="n">shouldDisplayItem</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
  
  <span class="k">switch</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">purchaseStatus</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// products that returned errors or nothing when app store was queried</span>
    <span class="k">default</span><span class="o">:</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusUnknown:</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusError:</span>
      <span class="n">shouldDisplayItem</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="c1">// paid/purchaseable products</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusNonfreePurchased:</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusNonfreeUnpurchased:</span> <span class="p">{</span>
      <span class="n">shouldDisplayItem</span> <span class="o">=</span> <span class="n">product</span><span class="p">.</span><span class="n">isAvailableInStore</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
      
    <span class="c1">// free items might as well always show up, right?</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusFree:</span>
      <span class="n">shouldDisplayItem</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="n">shouldDisplayItem</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="purchaseableindicatorforproduct-">
  <h4>
    <a href="#purchaseableindicatorforproduct-" class="pilcrow">&#182;</a>
    purchaseableIndicatorForProduct:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">SECrackRockProduct*</span><code class="name">product</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">UIImage*</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span> <span class="nf">purchaseableIndicatorForProduct:</span> <span class="p">(</span><span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="p">)</span><span class="nv">product</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="iconforproduct-withpurchaseableindicator-">
  <h4>
    <a href="#iconforproduct-withpurchaseableindicator-" class="pilcrow">&#182;</a>
    iconForProduct:withPurchaseableIndicator:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">SECrackRockProduct*</span><code class="name">product</code></div><div class="dox_tag_detail"><span class="dox_type">BOOL</span><code class="name">withPurchaseableIndicator</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">UIImage*</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span> <span class="nf">iconForProduct:</span><span class="p">(</span><span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="p">)</span><span class="nv">product</span> <span class="nf">withPurchaseableIndicator:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">withPurchaseableIndicator</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">product</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;product argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="c1">// load the product&#39;s icon, add the &#39;purchaseable&#39; indicator overlay if it hasn&#39;t been purchased yet</span>
  <span class="n">UIImage</span> <span class="o">*</span><span class="n">icon</span> <span class="o">=</span> <span class="n">UIImageWithBundlePNG</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">thumbnailPNGFilename</span><span class="p">);</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">icon</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;icon is nil.&quot;</span><span class="p">);</span>   
  
  <span class="k">if</span> <span class="p">(</span><span class="n">withPurchaseableIndicator</span> <span class="o">==</span> <span class="n">YES</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">purchaseableIndicator</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">purchaseableIndicatorForProduct:</span> <span class="n">product</span><span class="p">];</span>
    
    <span class="c1">// if a purchaseableIndicator was provided, replace the existing icon with one that has the indicator overlaid</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">purchaseableIndicator</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">icon</span> <span class="o">=</span> <span class="p">[</span><span class="n">icon</span> <span class="nl">imageWithOverlay:</span><span class="n">purchaseableIndicator</span> <span class="nl">atPosition:</span><span class="n">CGPointZero</span> <span class="nl">withSize:</span><span class="n">icon</span><span class="p">.</span><span class="n">size</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="n">icon</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="initializemenuitems">
  <h4>
    <a href="#initializemenuitems" class="pilcrow">&#182;</a>
    initializeMenuItems
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">NSMutableArray*</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">NSMutableArray</span> <span class="o">*</span><span class="p">)</span> <span class="nf">initializeMenuItems</span> <span class="p">{</span>
  
  <span class="c1">// create an array of SEBlingLord objects</span>
  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nl">arrayWithCapacity:</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">sortedProductIDs</span><span class="p">.</span><span class="n">count</span><span class="p">];</span>
  
  <span class="n">__bryn_weak</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">productID</span> <span class="k">in</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">sortedProductIDs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="n">product</span> <span class="o">=</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">productsByID</span><span class="p">[</span> <span class="n">productID</span> <span class="p">];</span>
    
    <span class="c1">// make sure we want to display each product (i.e. the request to the app store was successful) </span>
    <span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="nl">shouldDisplayProductInStore:</span> <span class="n">product</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO</span><span class="p">)</span>
      <span class="k">continue</span><span class="p">;</span>
    
    <span class="c1">// generate the product&#39;s icon</span>
    <span class="kt">BOOL</span> <span class="n">showPurchaseableIndicator</span> <span class="o">=</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">purchaseStatus</span> <span class="o">==</span> <span class="n">SECrackRockPurchaseStatusNonfreeUnpurchased</span><span class="p">);</span>
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">icon</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">iconForProduct:</span><span class="n">product</span> <span class="nl">withPurchaseableIndicator:</span><span class="n">showPurchaseableIndicator</span><span class="p">];</span>

    <span class="c1">// initialize the menu item object</span>
    <span class="n">SECrackRockMenuItem</span> <span class="o">*</span><span class="n">menuItem</span> <span class="o">=</span>
      <span class="p">[[</span><span class="n">SECrackRockMenuItem</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardItemSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardItemSize</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
                                           <span class="nl">title:</span> <span class="n">product</span><span class="p">.</span><span class="n">readableName</span> <span class="nl">image:</span> <span class="n">icon</span>
                                       <span class="nl">removable:</span> <span class="n">NO</span>
                                 <span class="nl">tapHandlerBlock:</span> <span class="o">^</span><span class="p">{</span>
                                     <span class="n">__strong</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">strongSelf</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">;</span>
                                     <span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="n">blockProduct</span> <span class="o">=</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">productsByID</span><span class="p">[</span> <span class="n">productID</span> <span class="p">];</span>
                                     <span class="n">NSAssert</span><span class="p">(</span><span class="n">blockProduct</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;blockProduct is nil.&quot;</span><span class="p">);</span>
                                     
                                     <span class="p">[</span><span class="n">strongSelf</span> <span class="nl">iconWasTappedForProduct:</span> <span class="n">blockProduct</span><span class="p">];</span>
                                 <span class="p">}];</span>
      
    <span class="n">menuItem</span><span class="p">.</span><span class="n">productID</span> <span class="o">=</span> <span class="n">product</span><span class="p">.</span><span class="n">productID</span><span class="p">;</span>
    <span class="p">[</span><span class="n">items</span> <span class="nl">addObject:</span> <span class="n">menuItem</span><span class="p">];</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="n">items</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="menuitemforproductid-">
  <h4>
    <a href="#menuitemforproductid-" class="pilcrow">&#182;</a>
    menuItemForProductID:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">productID</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">SECrackRockMenuItem*</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">SECrackRockMenuItem</span> <span class="o">*</span><span class="p">)</span> <span class="nf">menuItemForProductID:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productID</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">productID</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">SECrackRockMenuItem</span> <span class="o">*</span><span class="n">menuItem</span> <span class="k">in</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardView</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">([</span><span class="n">productID</span> <span class="nl">isEqualToString:</span><span class="n">menuItem</span><span class="p">.</span><span class="n">productID</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">menuItem</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>



<span class="cp">#pragma mark- User interaction</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="iconwastappedforproduct-">
  <h4>
    <a href="#iconwastappedforproduct-" class="pilcrow">&#182;</a>
    iconWasTappedForProduct:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">SECrackRockProduct*</span><code class="name">product</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">iconWasTappedForProduct:</span> <span class="p">(</span><span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="p">)</span><span class="nv">product</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">product</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;product argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="k">switch</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">purchaseStatus</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusFree:</span>
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusNonfreePurchased:</span>
      <span class="c1">// this is where you&#39;d probably want to let the user use the purchase</span>
      <span class="k">break</span><span class="p">;</span>
      
    <span class="k">case</span> <span class="nl">SECrackRockPurchaseStatusNonfreeUnpurchased:</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">self</span> <span class="nl">tryToPurchaseProduct:</span> <span class="n">product</span><span class="p">.</span><span class="n">productID</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
      
    <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
      <span class="n">NSAssert</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="s">@&quot;SECrackRockProduct purchaseStatus is unknown.&quot;</span><span class="p">);</span>
      <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span> <span class="s">@&quot;Our bad&quot;</span>
                                  <span class="nl">message:</span> <span class="s">@&quot;An error occurred, and we don&#39;t know exactly why.  Maybe try again later!&quot;</span>
                                 <span class="nl">delegate:</span> <span class="nb">nil</span> <span class="nl">cancelButtonTitle:</span><span class="s">@&quot;OK&quot;</span> <span class="nl">otherButtonTitles:</span><span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>



<span class="cp">#pragma mark- Public methods for purchasing/restoring</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="trytopurchaseproduct-">
  <h4>
    <a href="#trytopurchaseproduct-" class="pilcrow">&#182;</a>
    tryToPurchaseProduct:
  </h4>
</div>
</div><div class="body"><p>Attempt to purchase a product with a given product ID.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">productID</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">tryToPurchaseProduct:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productID</span> <span class="p">{</span>
  
  <span class="n">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">tryToPurchaseProduct:</span><span class="n">productID</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">success</span> <span class="o">==</span> <span class="n">NO</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returned NO, so notify user that In-App Purchase is Disabled in their Settings.</span>
    <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span> <span class="s">@&quot;Allow Purchases&quot;</span>
                                <span class="nl">message:</span> <span class="s">@&quot;You must first enable In-App Purchase in your iOS Settings before making this purchase.&quot;</span>
                               <span class="nl">delegate:</span> <span class="nb">nil</span> <span class="nl">cancelButtonTitle:</span><span class="s">@&quot;OK&quot;</span> <span class="nl">otherButtonTitles:</span><span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
    
  <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="trytorestorepurchase-">
  <h4>
    <a href="#trytorestorepurchase-" class="pilcrow">&#182;</a>
    tryToRestorePurchase:
  </h4>
</div>
</div><div class="body"><p>Attempt to restore a customer's previous non-consumable or subscription
In-App Purchase with a given product ID.  Required if a user reinstalled app
on same device or another device.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">productID</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">tryToRestorePurchase:</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productID</span> <span class="p">{</span>
  
  <span class="n">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">tryToRestorePurchase:</span><span class="n">productID</span><span class="p">];</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">success</span> <span class="o">==</span> <span class="n">NO</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span> <span class="s">@&quot;Allow Purchases&quot;</span>
                                <span class="nl">message:</span> <span class="s">@&quot;You must first enable In-App Purchase in your iOS Settings before restoring a previous purchase.&quot;</span>
                               <span class="nl">delegate:</span> <span class="nb">nil</span> <span class="nl">cancelButtonTitle:</span> <span class="s">@&quot;OK&quot;</span> <span class="nl">otherButtonTitles:</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span> 
  <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="trytorestoreallpurchases">
  <h4>
    <a href="#trytorestoreallpurchases" class="pilcrow">&#182;</a>
    tryToRestoreAllPurchases
  </h4>
</div>
</div><div class="body"><p>Attempt to restore all purchases made with the current apple ID.</p></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">tryToRestoreAllPurchases</span> <span class="p">{</span>
  
  <span class="n">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">tryToRestoreAllPurchases</span><span class="p">];</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">success</span> <span class="o">==</span> <span class="n">NO</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// notify user that In-App Purchase is Disabled in their Settings.</span>
    <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span> <span class="s">@&quot;Allow Purchases&quot;</span>
                                <span class="nl">message:</span> <span class="s">@&quot;You must first enable In-App Purchase in your iOS Settings before restoring a previous purchase.&quot;</span>
                               <span class="nl">delegate:</span> <span class="nb">nil</span> <span class="nl">cancelButtonTitle:</span> <span class="s">@&quot;OK&quot;</span> <span class="nl">otherButtonTitles:</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>

  <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="didfinishpreparingproductinfo">
  <h4>
    <a href="#didfinishpreparingproductinfo" class="pilcrow">&#182;</a>
    didFinishPreparingProductInfo
  </h4>
</div>
</div><div class="body"><p>Called in response to <code>SECrackRockNotification_DidFinishPreparingProductInfo</code>.</p>

<p>Sets up the springboard view and creates a menu item for each product that
was verified as purchaseable by the app store.</p>

<p>Note: if you override this method in a subclass, you really oughta call the
superclass's method (i.e., <code>[super didFinishPreparingProductInfo]</code>).</p></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">didFinishPreparingProductInfo</span> <span class="p">{</span>
  
  <span class="c1">// initialize the menu items</span>
  
  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">menuItems</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">initializeMenuItems</span><span class="p">];</span>
  
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">menuItems</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;menuItems array is nil.&quot;</span><span class="p">);</span>
  
  <span class="c1">// pass the array to a new instance of SEBlingLord and add it to the view</span>
  
  <span class="n">CGRect</span> <span class="n">frame</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">UI_USER_INTERFACE_IDIOM</span><span class="p">()</span> <span class="o">==</span> <span class="n">UIUserInterfaceIdiomPhone</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">320.0f</span><span class="p">,</span> <span class="mf">480.0f</span> <span class="o">-</span> <span class="mf">20.0f</span><span class="p">);</span> <span class="c1">// 20.0f = status bar</span>
  <span class="k">else</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">768.0f</span><span class="p">,</span> <span class="mf">1024.0f</span> <span class="o">-</span> <span class="mf">20.0f</span><span class="p">);</span> <span class="c1">// @@TODO: is this correct for an iPad?</span>
  
  <span class="n">SEBlingLordView</span> <span class="o">*</span><span class="n">board</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SEBlingLordView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">frame</span><span class="p">];</span>
  <span class="n">board</span><span class="p">.</span><span class="n">itemSize</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardItemSize</span><span class="p">;</span>
  <span class="n">board</span><span class="p">.</span><span class="n">itemMargins</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardItemMargins</span><span class="p">;</span> <span class="c1">//  CGSizeMake(15.0f, 15.0f);</span>
  <span class="n">board</span><span class="p">.</span><span class="n">outerMargins</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">springboardOuterMargins</span><span class="p">;</span> <span class="c1">// CGSizeMake(10.0f, 10.0f);</span>
  <span class="n">board</span><span class="p">.</span><span class="n">allowsEditing</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
  <span class="p">[</span><span class="n">board</span> <span class="nl">addMenuItems:</span><span class="n">menuItems</span><span class="p">];</span>
  
  
  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">springboardView</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">springboardView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">springboardView</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span> <span class="n">board</span><span class="p">];</span>
  <span class="n">self</span><span class="p">.</span><span class="n">springboardView</span> <span class="o">=</span> <span class="n">board</span><span class="p">;</span>
  
  
  <span class="c1">// register a block to respond to the transaction state (i.e. whether or not a</span>
  <span class="c1">// transaction with the app store servers is pending).  this block toggles</span>
  <span class="c1">// user interaction with the springboard off when a transaction is underway,</span>
  <span class="c1">// and back on when it is done.</span>
  
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">removeHandlerWithID:</span> <span class="n">SECrackRockTransactionStateObserver_SpringboardView</span><span class="p">];</span> <span class="c1">// remove any existing observer</span>
  
  <span class="n">__bryn_weak</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
  <span class="p">[[</span><span class="n">SEStatelyNotificationRobot</span> <span class="n">sharedRobot</span><span class="p">]</span> <span class="nl">handleStateOf:</span> <span class="n">SECrackRockState_TransactionState</span>
                                                <span class="nl">handlerID:</span> <span class="n">SECrackRockTransactionStateObserver_SpringboardView</span>
                                                  <span class="nl">onQueue:</span> <span class="p">[</span><span class="n">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span>
                                                <span class="nl">withBlock:</span> <span class="o">^</span><span class="p">(</span><span class="n">SEState</span> <span class="n">newState</span><span class="p">,</span> <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">stateInfo</span><span class="p">)</span> <span class="p">{</span>
                                                  
                                                    <span class="n">__strong</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">strongSelf</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">;</span>
                                                    <span class="kt">BOOL</span> <span class="n">enabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">newState</span> <span class="o">==</span> <span class="n">SECrackRockTransactionStateAsleep</span><span class="p">);</span>
                                                    <span class="n">strongSelf</span><span class="p">.</span><span class="n">springboardView</span><span class="p">.</span><span class="n">userInteractionEnabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">;</span>
                                                  
                                                <span class="p">}];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="restorepurchasesbuttonclicked">
  <h4>
    <a href="#restorepurchasesbuttonclicked" class="pilcrow">&#182;</a>
    restorePurchasesButtonClicked
  </h4>
</div>
</div><div class="body"><p>Called when the user has clicked the 'restore all purchases' button.  Can
be rigged up to a button using Interface Builder, but does not need to be.</p></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">IBAction</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span> <span class="nf">restorePurchasesButtonClicked</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">self</span> <span class="n">tryToRestoreAllPurchases</span><span class="p">];</span>
<span class="p">}</span>



<span class="cm">/**</span>
<span class="cm"> *</span>
<span class="cm"> */</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="recreateproducticonwithoutpurchaseableindicator-">
  <h4>
    <a href="#recreateproducticonwithoutpurchaseableindicator-" class="pilcrow">&#182;</a>
    recreateProductIconWithoutPurchaseableIndicator:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">productID</code></div><div class="dox_tag_title"></div><div class="dox_tag_detail"></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">recreateProductIconWithoutPurchaseableIndicator:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productID</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">productID</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;productID argument is nil.&quot;</span><span class="p">);</span>

  <span class="c1">// recreate the product&#39;s icon without the purchaseable indicator</span>
  
  <span class="n">__bryn_weak</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
  <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
    <span class="n">__strong</span> <span class="n">SECrackRockViewController</span> <span class="o">*</span><span class="n">strongSelf</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">;</span>
    
    <span class="n">SECrackRockMenuItem</span> <span class="o">*</span><span class="n">springboardMenuItem</span> <span class="o">=</span> <span class="p">[</span><span class="n">strongSelf</span> <span class="nl">menuItemForProductID:</span><span class="n">productID</span><span class="p">];</span>
    <span class="n">SECrackRockProduct</span> <span class="o">*</span><span class="n">product</span> <span class="o">=</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">productsByID</span><span class="p">[</span> <span class="n">productID</span> <span class="p">];</span>
    
    <span class="n">springboardMenuItem</span><span class="p">.</span><span class="n">imageView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">strongSelf</span> <span class="nl">iconForProduct:</span><span class="n">product</span> <span class="nl">withPurchaseableIndicator:</span><span class="n">NO</span><span class="p">];</span>
  <span class="p">});</span>
  
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="displayalerttouserwithtitle-text-dismisstext-">
  <h4>
    <a href="#displayalerttouserwithtitle-text-dismisstext-" class="pilcrow">&#182;</a>
    displayAlertToUserWithTitle:text:dismissText:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">title</code></div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">text</code></div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">dismissText</code></div><div class="dox_tag_title"></div><div class="dox_tag_detail"></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">displayAlertToUserWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span> <span class="nf">text:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">text</span> <span class="nf">dismissText:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dismissText</span> <span class="p">{</span>
  <span class="p">[[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="n">title</span> <span class="nl">message:</span><span class="n">text</span> <span class="nl">delegate:</span><span class="nb">nil</span> <span class="nl">cancelButtonTitle:</span><span class="n">dismissText</span> <span class="nl">otherButtonTitles:</span><span class="nb">nil</span><span class="p">]</span> <span class="n">show</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="successfulpurchase-">
  <h4>
    <a href="#successfulpurchase-" class="pilcrow">&#182;</a>
    successfulPurchase:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">successfulPurchase:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="n">NSString</span> <span class="o">*</span><span class="n">productID</span> <span class="o">=</span> <span class="n">notification</span><span class="p">.</span><span class="n">userInfo</span><span class="p">[</span> <span class="n">SECrackRockUserInfoKey_ProductID</span> <span class="p">];</span>
  <span class="p">[</span><span class="n">self</span> <span class="nl">recreateProductIconWithoutPurchaseableIndicator:</span><span class="n">productID</span><span class="p">];</span>
    
  <span class="c1">// notify the user that the purchase was successful</span>
  <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Thank You!&quot;</span>
                               <span class="nl">text:</span> <span class="s">@&quot;Your purchase was successful!&quot;</span>
                        <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="cancelledpurchase-">
  <h4>
    <a href="#cancelledpurchase-" class="pilcrow">&#182;</a>
    cancelledPurchase:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">cancelledPurchase:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  <span class="c1">// no-op</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="failedpurchase-">
  <h4>
    <a href="#failedpurchase-" class="pilcrow">&#182;</a>
    failedPurchase:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">failedPurchase:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Purchase Failed&quot;</span>
                               <span class="nl">text:</span> <span class="s">@&quot;There was a transaction error. Please try again later, or contact customer support for assistance.&quot;</span>
                        <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="successfulrestore-">
  <h4>
    <a href="#successfulrestore-" class="pilcrow">&#182;</a>
    successfulRestore:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">successfulRestore:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="n">NSString</span> <span class="o">*</span><span class="n">productID</span> <span class="o">=</span> <span class="n">notification</span><span class="p">.</span><span class="n">userInfo</span><span class="p">[</span> <span class="n">SECrackRockUserInfoKey_ProductID</span> <span class="p">];</span>
  <span class="p">[</span><span class="n">self</span> <span class="nl">recreateProductIconWithoutPurchaseableIndicator:</span><span class="n">productID</span><span class="p">];</span>
  
  <span class="c1">// if it&#39;s a single item restore, notify the user that the restore was successful</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">NO</span> <span class="o">==</span> <span class="p">[</span><span class="n">SECrackRock</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">isCurrentlyRestoringMultiplePurchases</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Thank You!&quot;</span>
                                 <span class="nl">text:</span> <span class="s">@&quot;Your purchase was successfully restored!&quot;</span>
                          <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="multiplerestorecomplete-">
  <h4>
    <a href="#multiplerestorecomplete-" class="pilcrow">&#182;</a>
    multipleRestoreComplete:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">multipleRestoreComplete:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Success!&quot;</span>
                               <span class="nl">text:</span> <span class="s">@&quot;Your purchases were successfully restored!&quot;</span>
                        <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="incompleterestore-">
  <h4>
    <a href="#incompleterestore-" class="pilcrow">&#182;</a>
    incompleteRestore:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">incompleteRestore:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Restore Issue&quot;</span>
                               <span class="nl">text:</span> <span class="s">@&quot;A prior purchase transaction could not be found. To restore the purchased product, tap the product&#39;s icon. Paid customers will NOT be charged again, but the purchase will be restored.&quot;</span>
                        <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="failedrestore-">
  <h4>
    <a href="#failedrestore-" class="pilcrow">&#182;</a>
    failedRestore:
  </h4>
</div>
</div><div class="body"></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSNotification*</span><code class="name">notification</code></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">void</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">failedRestore:</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
  <span class="n">NSAssert</span><span class="p">(</span><span class="n">notification</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">,</span> <span class="s">@&quot;notification argument is nil.&quot;</span><span class="p">);</span>
  
  <span class="p">[</span><span class="n">self</span> <span class="nl">displayAlertToUserWithTitle:</span> <span class="s">@&quot;Restore Stopped&quot;</span>
                               <span class="nl">text:</span> <span class="s">@&quot;Either you cancelled the request or your prior purchase could not be restored. Please try again later, or contact customer support for assistance.&quot;</span>
                        <span class="nl">dismissText:</span> <span class="s">@&quot;OK&quot;</span><span class="p">];</span>
<span class="p">}</span>





<span class="k">@end</span>
</pre></div></td></tr></tbody></table></div></body></html>